<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="es"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>GlobalExceptionHandler.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">inventory-service</a> &gt; <a href="index.source.html" class="el_package">com.example.inventoryservice.infrastructure.web.exception</a> &gt; <span class="el_source">GlobalExceptionHandler.java</span></div><h1>GlobalExceptionHandler.java</h1><pre class="source lang-java linenums">package com.example.inventoryservice.infrastructure.web.exception;

import com.example.inventoryservice.domain.exception.*;
import java.time.LocalDateTime;
import lombok.extern.slf4j.Slf4j;
import org.springframework.http.HttpStatus;
import org.springframework.http.ResponseEntity;
import org.springframework.web.bind.annotation.ControllerAdvice;
import org.springframework.web.bind.annotation.ExceptionHandler;
import org.springframework.web.context.request.WebRequest;


@ControllerAdvice
<span class="fc" id="L14">@Slf4j</span>
<span class="fc" id="L15">public class GlobalExceptionHandler {</span>
    
    @ExceptionHandler(InventoryNotFoundException.class)
    public ResponseEntity&lt;ErrorResponse&gt; handleInventoryNotFoundException(
            InventoryNotFoundException ex, WebRequest request) {
<span class="nc" id="L20">        log.error(&quot;Inventory not found: {}&quot;, ex.getMessage());</span>
<span class="nc" id="L21">        ErrorResponse errorResponse = ErrorResponse.builder()</span>
<span class="nc" id="L22">                .timestamp(LocalDateTime.now())</span>
<span class="nc" id="L23">                .status(HttpStatus.NOT_FOUND.value())</span>
<span class="nc" id="L24">                .error(&quot;Inventory Not Found&quot;)</span>
<span class="nc" id="L25">                .message(ex.getMessage())</span>
<span class="nc" id="L26">                .path(request.getDescription(false))</span>
<span class="nc" id="L27">                .build();</span>
<span class="nc" id="L28">        return new ResponseEntity&lt;&gt;(errorResponse, HttpStatus.NOT_FOUND);</span>
    }
    
    @ExceptionHandler(ProductNotFoundException.class)
    public ResponseEntity&lt;ErrorResponse&gt; handleProductNotFoundException(
            ProductNotFoundException ex, WebRequest request) {
<span class="fc" id="L34">        log.error(&quot;Product not found: {}&quot;, ex.getMessage());</span>
<span class="fc" id="L35">        ErrorResponse errorResponse = ErrorResponse.builder()</span>
<span class="fc" id="L36">                .timestamp(LocalDateTime.now())</span>
<span class="fc" id="L37">                .status(HttpStatus.NOT_FOUND.value())</span>
<span class="fc" id="L38">                .error(&quot;Product Not Found&quot;)</span>
<span class="fc" id="L39">                .message(ex.getMessage())</span>
<span class="fc" id="L40">                .path(request.getDescription(false))</span>
<span class="fc" id="L41">                .build();</span>
<span class="fc" id="L42">        return new ResponseEntity&lt;&gt;(errorResponse, HttpStatus.NOT_FOUND);</span>
    }
    
    @ExceptionHandler(InsufficientStockException.class)
    public ResponseEntity&lt;ErrorResponse&gt; handleInsufficientStockException(
            InsufficientStockException ex, WebRequest request) {
<span class="fc" id="L48">        log.error(&quot;Insufficient stock: {}&quot;, ex.getMessage());</span>
<span class="fc" id="L49">        ErrorResponse errorResponse = ErrorResponse.builder()</span>
<span class="fc" id="L50">                .timestamp(LocalDateTime.now())</span>
<span class="fc" id="L51">                .status(HttpStatus.CONFLICT.value())</span>
<span class="fc" id="L52">                .error(&quot;Insufficient Stock&quot;)</span>
<span class="fc" id="L53">                .message(ex.getMessage())</span>
<span class="fc" id="L54">                .path(request.getDescription(false))</span>
<span class="fc" id="L55">                .build();</span>
<span class="fc" id="L56">        return new ResponseEntity&lt;&gt;(errorResponse, HttpStatus.CONFLICT);</span>
    }
    
    @ExceptionHandler(ValidationException.class)
    public ResponseEntity&lt;ErrorResponse&gt; handleValidationException(
            ValidationException ex, WebRequest request) {
<span class="nc" id="L62">        log.error(&quot;Validation error: {}&quot;, ex.getMessage());</span>
<span class="nc" id="L63">        ErrorResponse errorResponse = ErrorResponse.builder()</span>
<span class="nc" id="L64">                .timestamp(LocalDateTime.now())</span>
<span class="nc" id="L65">                .status(HttpStatus.BAD_REQUEST.value())</span>
<span class="nc" id="L66">                .error(&quot;Validation Error&quot;)</span>
<span class="nc" id="L67">                .message(ex.getMessage())</span>
<span class="nc" id="L68">                .path(request.getDescription(false))</span>
<span class="nc" id="L69">                .build();</span>
<span class="nc" id="L70">        return new ResponseEntity&lt;&gt;(errorResponse, HttpStatus.BAD_REQUEST);</span>
    }
    
    @ExceptionHandler(ExternalServiceException.class)
    public ResponseEntity&lt;ErrorResponse&gt; handleExternalServiceException(
            ExternalServiceException ex, WebRequest request) {
<span class="nc" id="L76">        log.error(&quot;External service error: {}&quot;, ex.getMessage());</span>
<span class="nc" id="L77">        ErrorResponse errorResponse = ErrorResponse.builder()</span>
<span class="nc" id="L78">                .timestamp(LocalDateTime.now())</span>
<span class="nc" id="L79">                .status(HttpStatus.BAD_GATEWAY.value())</span>
<span class="nc" id="L80">                .error(&quot;External Service Error&quot;)</span>
<span class="nc" id="L81">                .message(ex.getMessage())</span>
<span class="nc" id="L82">                .path(request.getDescription(false))</span>
<span class="nc" id="L83">                .build();</span>
<span class="nc" id="L84">        return new ResponseEntity&lt;&gt;(errorResponse, HttpStatus.BAD_GATEWAY);</span>
    }
    
    @ExceptionHandler(IllegalArgumentException.class)
    public ResponseEntity&lt;ErrorResponse&gt; handleIllegalArgumentException(
            IllegalArgumentException ex, WebRequest request) {
<span class="fc" id="L90">        log.error(&quot;Invalid argument: {}&quot;, ex.getMessage());</span>
<span class="fc" id="L91">        ErrorResponse errorResponse = ErrorResponse.builder()</span>
<span class="fc" id="L92">                .timestamp(LocalDateTime.now())</span>
<span class="fc" id="L93">                .status(HttpStatus.BAD_REQUEST.value())</span>
<span class="fc" id="L94">                .error(&quot;Invalid Argument&quot;)</span>
<span class="fc" id="L95">                .message(ex.getMessage())</span>
<span class="fc" id="L96">                .path(request.getDescription(false))</span>
<span class="fc" id="L97">                .build();</span>
<span class="fc" id="L98">        return new ResponseEntity&lt;&gt;(errorResponse, HttpStatus.BAD_REQUEST);</span>
    }
    
    @ExceptionHandler(Exception.class)
    public ResponseEntity&lt;ErrorResponse&gt; handleGlobalException(
            Exception ex, WebRequest request) {
<span class="nc" id="L104">        log.error(&quot;Unexpected error occurred&quot;, ex);</span>
<span class="nc" id="L105">        ErrorResponse errorResponse = ErrorResponse.builder()</span>
<span class="nc" id="L106">                .timestamp(LocalDateTime.now())</span>
<span class="nc" id="L107">                .status(HttpStatus.INTERNAL_SERVER_ERROR.value())</span>
<span class="nc" id="L108">                .error(&quot;Internal Server Error&quot;)</span>
<span class="nc" id="L109">                .message(&quot;An unexpected error occurred&quot;)</span>
<span class="nc" id="L110">                .path(request.getDescription(false))</span>
<span class="nc" id="L111">                .build();</span>
<span class="nc" id="L112">        return new ResponseEntity&lt;&gt;(errorResponse, HttpStatus.INTERNAL_SERVER_ERROR);</span>
    }
}

</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.12.202403310830</span></div></body></html>